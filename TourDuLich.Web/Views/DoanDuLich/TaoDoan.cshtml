@model TourDuLich.Web.Models.KhachHangViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Layout.cshtml";
    var successMessage = (string)TempData["Success"];
    var errorMessage = (string)TempData["Error"];
    var listKhachHang = Session["dsKhachHang"] as List<TourDuLich.Web.Models.KhachHangViewModel>;
    SelectList GioiTinhSelectList = new SelectList(new List<SelectListItem>
    {
        new SelectListItem()
        {
            Text = "Nam",
            Value = "true"
        },
        new SelectListItem()
        {
            Text = "Nữ",
            Value = "false"
        }
    }, "Value", "Text");
}
@section headerCSS {
    <link href="~/Assets/template/lib/highlightjs/github.css" rel="stylesheet">
    <link href="~/Assets/template/lib/datatables/jquery.dataTables.css" rel="stylesheet">
    <link href="~/Assets/template/lib/select2/css/select2.min.css" rel="stylesheet">
    <style>
        select.ui-datepicker-month {
            width: 80px;
            padding: 2px 0;
        }
        select.ui-datepicker-year {
            width: 80px;
            padding: 2px 0;
            margin-left: 5px;
        }
    </style>
}
@section footerJS {
    <script src="~/Assets/template/lib/highlightjs/highlight.pack.js"></script>
    <script src="~/Assets/template/lib/datatables/jquery.dataTables.js"></script>
    <script src="~/Assets/template/lib/datatables-responsive/dataTables.responsive.js"></script>
    <script src="~/Assets/template/lib/select2/js/select2.min.js"></script>
    <script>
        $(function () {
            $('#tableKhachHang').DataTable({
                bLengthChange: false,
                searching: true,
                responsive: true,
                language: {
                    searchPlaceholder: 'Search...',
                    sSearch: ''
                }
            });
            $("select option:first-child").attr("disabled", "disabled");
            // Datepicker
            $('.fc-datepicker').datepicker({
                dateFormat: "dd / mm / yy",
                yearRange: "1930:2030",
                changeMonth: true,
                changeYear: true,
                showOtherMonths: true,
                selectOtherMonths: true
            });
            $("#MaTour").change(function () {
                $.ajax({
                    url: "/lay-thoi-gian-tour",
                    dataType: "json",
                    data: {
                        MaTour: $(this).val()
                    },
                    success: function (data) {
                        if (jQuery.isEmptyObject(data)) {
                            var optionHTML = "<option selected disabled>Chưa có thời gian hoạt động</option>";
                            $("#ThoiGianTour_MaThoiGianTour").html(optionHTML);
                        }
                        else {
                            var optionHTML = "<option selected disabled>Chọn thời gian</option>";
                            $.each(data, function (i, item) {
                                optionHTML += "<option value='" + item.MaThoiGian + "'>" + item.ThoiGian + "</option>";
                            });
                            $("#ThoiGianTour_MaThoiGianTour").html(optionHTML);
                        }

                    }
                });
            });
            $(".kh-remove").on("click", function () {
                var makh = $(this).attr("data-ma-kh");
                $.ajax({
                    url: "/xoa-khach-hang",
                    data: {
                        id: makh
                    },
                    success: function (res) {
                    }
                });
                $(this).parents("tr").hide(300, function () {
                    $(this).remove();
                });
            });

        });

        @if(successMessage != null && successMessage.Length != 0)
        {
            @:showSuccessToast("@successMessage");
        }
        @if(errorMessage != null && errorMessage.Length != 0)
        {
            @:showErrorToast("@errorMessage");
        }
    </script>
}
<nav class="breadcrumb sl-breadcrumb">
    <a class="breadcrumb-item" href="/">KJ Tourist</a>
    <span class="breadcrumb-item active">Tạo đoàn du lịch</span>
</nav>
<div class="sl-pagebody">
    <div class="card pd-20 pd-sm-40">
        <h6 class="card-body-title">Thông tin đoàn du lịch</h6>
        <p class="mg-b-20 mg-sm-b-20"></p>
        
        <div class="form-layout">
                @using (Html.BeginForm("DangKyThongTin", "KhachHang", FormMethod.Post, new { @class = "form-layout" }))
                {
                    @Html.AntiForgeryToken()
                    <div class="row">
                            <div class="col-lg-8">
                                <div class="form-group">
                                    <label class="form-control-label">Tên đoàn du lịch: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(m => m.HoTen, new { @class= "form-control", placeholder = "Nhập vào họ tên đầy đủ" })
                                </div>
                            </div><!-- col-4 -->  
                    </div><!-- row -->
                    <div class="row">                       
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Trưởng đoàn: <span class="tx-danger">*</span></label>
                                @Html.TextBoxFor(m => m.SoChungMinh, new { @class = "form-control", placeholder = "Nhập vào số CMND hoặc Passport" })
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Hướng dẫn viên: <span class="tx-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="icon ion-calendar tx-16 lh-0 op-6"></i></span>
                                    @Html.TextBoxFor(m => m.NgaySinh, new { @class = "form-control fc-datepicker", placeholder = "Nhập vào ngày tháng năm sinh" })
                                </div>
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group mg-b-10-force">
                                <label class="form-control-label">Phục vụ: <span class="tx-danger">*</span></label>
                                @Html.TextBoxFor(m => m.SoChungMinh, new { @class = "form-control", placeholder = "Nhập vào số CMND hoặc Passport" })
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group mg-b-10-force">
                                <label class="form-control-label">Tài xế: <span class="tx-danger">*</span></label>
                                @Html.TextBoxFor(m => m.SoDienThoai, new { @class = "form-control", placeholder = "Nhập vào số điện thoại liên lạc" })
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group mg-b-10-force">
                                <label class="form-control-label">Tiền trạm: <span class="tx-danger">*</span></label>
                                @Html.TextBoxFor(m => m.TenCongTy, new { @class = "form-control", placeholder = "Nhập vào tên công ty" })
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group mg-b-10-force">
                                <label class="form-control-label">Thông dịch viên: <span class="tx-danger">*</span></label>
                                @Html.TextBoxFor(m => m.DiaChi, new { @class = "form-control", placeholder = "Nhập vào địa chỉ cư trú" })
                            </div>
                        </div><!-- col-4 -->                        
                    </div><!-- row -->
                    <div class="table-responsive" style="margin-top:50px; margin-bottom:35px;">
                        <h6 class="card-body-title">Danh sách khách hàng đăng ký</h6>
                        <table id="tableKhachHang" class="table responsive table-hover table-bordered mg-b-0">
                            <thead>
                                <tr>
                                    <th class="wd-5p">
                                        <label class="ckbox mg-b-0">
                                            <input id="check-all" type="checkbox"><span></span>
                                        </label>
                                    </th>
                                    <th class="wd-15p">Họ tên</th>
                                    <th class="wd-5p">Giới tính</th>
                                    <th class="wd-10p">Ngày sinh</th>
                                    <th class="wd-10p">CMND / Passport</th>
                                    <th class="wd-10p">Điện thoại</th>
                                    <th class="wd-10p">Tên công ty</th>
                                    <th class="wd-10p">Thời gian</th>
                                    <th class="wd-15p">Tour</th>
                                </tr>
                            </thead>
                            <tbody>
                                @*@if (listKhachHang != null)
                                    {
                                        foreach (var kh in listKhachHang)
                                        {
                                            <tr>
                                                <td>
                                                    <label class="ckbox mg-b-0">
                                                        <input class="item-check" type="checkbox"><span></span>
                                                    </label>
                                                </td>
                                                <td>@kh.KhachHang.HoTen</td>
                                                <td>@if (kh.KhachHang.GioiTinh == true)
                                                { @("Nam") }
                                                else
                                                { @("Nữ") }</td>
                                                <td>@kh.KhachHang.NgaySinh.Value.ToString("dd/MM/yyyy")</td>
                                                <td>@kh.KhachHang.CMND @kh.KhachHang.Passport</td>
                                                <td>@kh.KhachHang.SoDienThoai</td>
                                                <td>@kh.KhachHang.TenCongTy</td>
                                                <td>@kh.ThoiGianTour.NgayDi.Value.ToString("dd/MM/yyyy") - @kh.ThoiGianTour.NgayVe.Value.ToString("dd/MM/yyyy")</td>
                                                <td>@kh.ThoiGianTour.Tour.TenTour</td>
                                            </tr>
                                        }
                                    }*@
                            </tbody>
                        </table>
                    </div><!-- table-responsive -->
                    <div class="row mg-b-25">                             
                        <div class="col-lg-6">
                            <div class="form-group form-layout-footer" style="margin-top: 20px;">
                                <button type="submit" class="btn btn-info mg-r-5">Tạo đoàn du lịch</button>
                                <button type="reset" class="btn btn-secondary">Làm mới</button>
                            </div>
                        </div><!-- col-6 -->
                        <div class="col-lg-6 pull-right">
                            <div class="form-group" style="margin-top: 20px;">
                                @Html.ValidationSummary()
                                <span class="tour-error">@ViewBag.Error</span>
                                <span class="tour-error">@ViewBag.Success</span>
                            </div>
                        </div><!-- col-6 -->
                    </div>
                }                
        </div><!-- form-layout -->
    </div><!-- card -->
</div><!-- sl-pagebody -->
